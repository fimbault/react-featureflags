import{useRef as n,useEffect as e,useCallback as t,createContext as r,useState as u,createElement as i,useContext as o}from"react";function s(){return global.document||{}}function c(r){var u,i,o,c,a,f=void 0!==(u=s()).hidden?["hidden","visibilitychange"]:void 0!==u.msHidden?["msHidden","msvisibilitychange"]:void 0!==u.webkitHidden?["webkitHidden","webkitvisibilitychange"]:["hidden","visibilitychange"],l=f[0],v=f[1],d=t((function(){var n;r((n=l,!!s()[n]))}),[r]);i=v,o=d,c=s(),a=n(),e((function(){a.current=o}),[o]),e((function(){if(c&&c.addEventListener){var n=function(n){a&&a.current(n)};return c.addEventListener(i,n),function(){c.removeEventListener(i,n)}}}),[i,c])}var a;function f(){return a&&a.flags||null}function l(){return a&&a.environment||null}function v(){return a&&a.namespace||null}function d(n){a=n}var h=function(t,r){var u=n();e((function(){u.current=t})),e((function(){if(null!==r){var n=setInterval((function(){u.current&&u.current()}),r);return function(){return clearTimeout(n)}}}),[r])},g=r(null);var m=function(n){var e,t,r=n.clientID,u=n.namespace,i=n.environment,o=n.featureFlagsAPI,s=n.uniqueID;return(e=(o||"https://resolver.twoflags.io")+"/?account="+r+"&ns="+u+(i?"&env="+i:"")+(s?"&uid="+s:""),t=t||{},new Promise((function(n,r){var u=new XMLHttpRequest,i=[],o=[],s={},c=function(){return{ok:2==(u.status/100|0),statusText:u.statusText,status:u.status,url:u.responseURL,text:function(){return Promise.resolve(u.responseText)},json:function(){return Promise.resolve(JSON.parse(u.responseText))},blob:function(){return Promise.resolve(new Blob([u.response]))},clone:c,headers:{keys:function(){return i},entries:function(){return o},get:function(n){return s[n.toLowerCase()]},has:function(n){return n.toLowerCase()in s}}}};for(var a in u.open(t.method||"get",e,!0),u.onload=function(){u.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(n,e,t){i.push(e=e.toLowerCase()),o.push([e,t]),s[e]=s[e]?s[e]+","+t:t})),n(c())},u.onerror=r,u.withCredentials="include"==t.credentials,t.headers)u.setRequestHeader(a,t.headers[a]);u.send(t.body||null)}))).then((function(n){return n.json()}))},p=function(n){return!n||n&&n<3e4?3e4:n},b=function(n){var t=n.clientID,r=n.namespace,o=n.featureFlagsAPI,s=n.uniqueID,a=n.fetchInterval,f=n.logging,l=n.children,v=u(null),b=v[0],w=v[1],I=u(null),P=I[0],y=I[1],L=u(s),D=L[0],H=L[1],k=function(){return m({clientID:t,namespace:r,featureFlagsAPI:o,uniqueID:D}).then((function(n){if(b){var e=(r=b,u=n,Object.keys(u).reduce((function(n,e){return r[e]!==u[e]&&(n[e]=u[e]),n}),{}));if(!function(n){for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}(e)){var t=Object.assign({},b,e);w(t),d(t)}}else w(n),d(n);var r,u}))};c((function(n){y(null),n||k().then((function(){return y(p(a))}))})),e((function(){f&&b&&f(b)}),[b]),e((function(){k(),y(p(a))}),[D]),h((function(){return k()}),P);return b?i(g.Provider,{value:{flags:b,setUniqueID:function(n){H(n)}}},l):null},w=function(){var n=o(g);return n?n.flags.flags:n};export{g as FeatureFlagsContext,b as FeatureFlagsProvider,m as getFeatureFlags,l as getRuntimeEnvironment,f as getRuntimeFeatureFlags,v as getRuntimeNamespace,d as setRuntimeFeatureFlags,w as useFeatureFlags};
//# sourceMappingURL=index.es.js.map

import{useRef as n,useEffect as e,useCallback as t,createContext as r,useState as i,createElement as u,useContext as o}from"react";function s(){return global.document||{}}function c(r){var i,u,o,c,a,f=void 0!==(i=s()).hidden?["hidden","visibilitychange"]:void 0!==i.msHidden?["msHidden","msvisibilitychange"]:void 0!==i.webkitHidden?["webkitHidden","webkitvisibilitychange"]:["hidden","visibilitychange"],l=f[0],d=f[1],v=t((function(){var n;r((n=l,!!s()[n]))}),[r]);u=d,o=v,c=s(),a=n(),e((function(){a.current=o}),[o]),e((function(){if(c&&c.addEventListener){var n=function(n){a&&a.current(n)};return c.addEventListener(u,n),function(){c.removeEventListener(u,n)}}}),[u,c])}var a;function f(){return a}function l(n){a=n}var d=function(t,r){var i=n();e((function(){i.current=t})),e((function(){if(null!==r){var n=setInterval((function(){i.current&&i.current()}),r);return function(){return clearTimeout(n)}}}),[r])},v=r(null);var h=function(n){var e,t,r=n.clientID,i=n.namespace,u=n.environment,o=n.featureFlagsAPI;return(e=(o||"https://resolver.twoflags.io")+"/?account="+r+"&ns="+i+(u?"&env="+u:""),t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,u=[],o=[],s={},c=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(JSON.parse(i.responseText))},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:c,headers:{keys:function(){return u},entries:function(){return o},get:function(n){return s[n.toLowerCase()]},has:function(n){return n.toLowerCase()in s}}}};for(var a in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(n,e,t){u.push(e=e.toLowerCase()),o.push([e,t]),s[e]=s[e]?s[e]+","+t:t})),n(c())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(a,t.headers[a]);i.send(t.body||null)}))).then((function(n){return n.json()}))},g=function(n){return!n||n&&n<3e4?3e4:n},m=function(n){var t=n.clientID,r=n.namespace,o=n.featureFlagsAPI,s=n.fetchInterval,a=n.logging,f=n.children,m=i(null),p=m[0],b=m[1],w=i(null),P=w[0],y=w[1],I=function(){return h({clientID:t,namespace:r,featureFlagsAPI:o}).then((function(n){if(p){var e=(r=p,i=n.flags,Object.keys(i).reduce((function(n,e){return r[e]!==i[e]&&(n[e]=i[e]),n}),{}));if(!function(n){for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}(e)){var t=Object.assign({},p,e);b(t),l(t)}}else b(n.flags),l(n.flags);var r,i}))};return c((function(n){y(null),n||I().then((function(){return y(g(s))}))})),e((function(){a&&p&&a(p)}),[p]),e((function(){I(),y(g(s))}),[]),d((function(){return I()}),P),p?u(v.Provider,{value:p},f):null},p=function(){return o(v)};export{v as FeatureFlagsContext,m as FeatureFlagsProvider,h as getFeatureFlags,f as getRuntimeFeatureFlags,p as useFeatureFlags};
//# sourceMappingURL=index.es.js.map

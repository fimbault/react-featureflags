import{useRef as n,useEffect as e,useCallback as t,createContext as r,useState as u,createElement as i,useContext as o}from"react";function s(){return global.document||{}}function a(r){var u,i,o,a,c,f=void 0!==(u=s()).hidden?["hidden","visibilitychange"]:void 0!==u.msHidden?["msHidden","msvisibilitychange"]:void 0!==u.webkitHidden?["webkitHidden","webkitvisibilitychange"]:["hidden","visibilitychange"],l=f[0],v=f[1],d=t((function(){var n;r((n=l,!!s()[n]))}),[r]);i=v,o=d,a=s(),c=n(),e((function(){c.current=o}),[o]),e((function(){if(a&&a.addEventListener){var n=function(n){c&&c.current(n)};return a.addEventListener(i,n),function(){a.removeEventListener(i,n)}}}),[i,a])}var c;function f(){return c&&c.flags||null}function l(){return c&&c.environment||null}function v(){return c&&c.namespace||null}function d(n){c=n}var g=function(t,r){var u=n();e((function(){u.current=t})),e((function(){if(null!==r){var n=setInterval((function(){u.current&&u.current()}),r);return function(){return clearTimeout(n)}}}),[r])},h=r(null);var m=function(n){var e,t,r=n.clientID,u=n.namespace,i=n.environment,o=n.featureFlagsAPI,s=n.uniqueID;return(e=(o||"https://resolver.twoflags.io")+"/?account="+r+"&ns="+u+(i?"&env="+i:"")+(s?"&uid="+s:""),t=t||{},new Promise((function(n,r){var u=new XMLHttpRequest,i=[],o=[],s={},a=function(){return{ok:2==(u.status/100|0),statusText:u.statusText,status:u.status,url:u.responseURL,text:function(){return Promise.resolve(u.responseText)},json:function(){return Promise.resolve(JSON.parse(u.responseText))},blob:function(){return Promise.resolve(new Blob([u.response]))},clone:a,headers:{keys:function(){return i},entries:function(){return o},get:function(n){return s[n.toLowerCase()]},has:function(n){return n.toLowerCase()in s}}}};for(var c in u.open(t.method||"get",e,!0),u.onload=function(){u.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(n,e,t){i.push(e=e.toLowerCase()),o.push([e,t]),s[e]=s[e]?s[e]+","+t:t})),n(a())},u.onerror=r,u.withCredentials="include"==t.credentials,t.headers)u.setRequestHeader(c,t.headers[c]);u.send(t.body||null)}))).then((function(n){return n.json()}))},p=function(n){return!n||n&&n<3e4?3e4:n},b=function(n){var t=n.clientID,r=n.namespace,o=n.featureFlagsAPI,s=n.uniqueID,c=n.fetchInterval,f=n.logging,l=n.children,v=u(null),b=v[0],I=v[1],w=u(null),P=w[0],y=w[1],D=u(s),L=D[0],q=D[1],H=function(){return m({clientID:t,namespace:r,featureFlagsAPI:o,uniqueID:L}).then((function(n){if(b){var e=(r=b,u=n,Object.keys(u).reduce((function(n,e){return r[e]!==u[e]&&(n[e]=u[e]),n}),{}));if(!function(n){for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}(e)){var t=Object.assign({},b,e);I(t),d(t)}}else I(n),d(n);var r,u}))};a((function(n){y(null),n||H().then((function(){return y(p(c))}))})),e((function(){f&&b&&f(b)}),[b]),e((function(){H(),y(p(c))}),[L]),g((function(){return H()}),P);return b?i(h.Provider,{value:{flags:b,setUniqueID:function(n){q(n)}}},l):null},I=function(){var n=o(h);return n?n.flags.flags:n},w=function(){var n=o(h);return n?n.flags.environment:n},P=function(){var n=o(h);return n?n.flags.namespace:n},y=function(){var n=o(h);return n?n.setUniqueID:n};export{h as FeatureFlagsContext,b as FeatureFlagsProvider,m as getFeatureFlags,l as getRuntimeEnvironment,f as getRuntimeFeatureFlags,v as getRuntimeNamespace,d as setRuntimeFeatureFlags,I as useFeatureFlags,w as useFeatureFlagsEnvironment,P as useFeatureFlagsNamespace,y as useFeatureFlagsUniqueIDUpdater};
//# sourceMappingURL=index.es.js.map
